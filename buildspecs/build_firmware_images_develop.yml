version: 0.2

run-as: builder

phases:
  pre_build:
    on-failure: ABORT
    commands:
      # change ownership of mounted EFS volumes
      - sudo chown builder:builder /mnt/yocto_cache/dl_dir /mnt/yocto_cache/sstate_cache
      # set target images
      - export images="$(for i in ${IMAGES}; do echo -n "mc:${MULTI_CONF}:${i} "; done)"

  build:
    on-failure: ABORT
    commands:
      # build images
      - kas shell -k -c "bitbake ${images}" kas-irma6-base.yml:include/kas-irma6-jenkins-develop.yml
